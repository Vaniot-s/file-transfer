<!DOCTYPE html>
<html>
<head>
	<title>login</title>
	<meta charset="utf-8">
</head>
<body>
    	<label for="user">用户名: </label><input type="text" id="username"  placeholder="输入用户名"><br>
    	<label for="pwd">密 码: </label>&nbsp;&nbsp;&nbsp;<input type="password"  id="pwd" placeholder="密码" ><br>
    	<button id="login" >登录</button> <button id="register">注册</button>
   <script>
   //异步提交
    function data(action){
      var ajax=new XMLHttpRequest();
      ajax.open("post",'action.php');//post方式提交
      var data='act=user&action='+action+'&username='+document.getElementById('username').value+"&password="+document.getElementById('pwd').value;
      ajax.setRequestHeader("Content-type","application/x-www-form-urlencoded"); //设置http头部
      ajax.send(data);//发送数据
      ajax.onreadystatechange=function(){//
      if (ajax.readyState===4) {
        if (ajax.status===200) {
            console.log(ajax.responseText);
          var da=JSON.parse(ajax.responseText);//接收返回的数据格式
          console.log(ajax.responseText);
          if (action=='login') {
            if (da.status=='sucess') {
              alert('操作成功');
              document.cookie='username='+da.username;
              location.href="./";
            }else{
            alert('操作失败');
          }
        }else if (action=='logined') {
          if (da.status=='logined') {
            location.href="./";
          }
        }else if(action=='register'){
          if (da.status=='sucess') {
              alert('操作成功');
              document.cookie='username='+document.getElementById('username').value;
              location.href="./";
            }else{
            alert('操作失败');
          }
        }
        }else{
          alert("发生错误："+ajax.status);
        }
      }
    }
    }
    document.getElementById('login').onclick=function(){data('login');}//点击提交
    document.getElementById('register').onclick=function(){data('register');}//注册
    window.onload=function(){data('logined')};
   </script>
</body>
</html>